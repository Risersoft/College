@using risersoft.shared.web.Extensions
@using Newtonsoft.Json
@using risersoft.app.mxform.college

@model frmStuPersonModel
@{
    ViewData["Title"] = "";
    Layout = "~/Views/Shared/_FrameworkLayout.vbhtml";
    var modelJson = JsonConvert.SerializeObject(Model, Formatting.Indented,
                            new JsonSerializerSettings { StringEscapeHandling = StringEscapeHandling.EscapeHtml, NullValueHandling = NullValueHandling.Ignore });
}

<link href="~/Content/custom-calander.css" rel="stylesheet" />
<script src="~/Scripts/moment.js"></script>
<script src="~/Scripts/jQueryUI-datetimepicker.js"></script>

<div Class="container cbackground">
    <form action="" method="post" name="userform" id="userform" ng-controller="FormController">
        <input type="hidden" id="model_json" value='@Html.Raw(modelJson)' />
        <input type="hidden" id="fileStatus" />

        @Html.AntiForgeryToken()
        <!-- Start Page Heading Section -->
        <div class="row">
            <div class="col-md-10">
                <label class="control-label"></label>
                <h5 style="color:#1c66a7">{{title}} Student Person</h5>
            </div>
            <div class="col-md-2"></div>
        </div>
        <hr />
        <!-- End Page Heading Section -->
        <!-- Start Page Content -->
        <div class="form-row">
            <div class="form-group col-md-3">
                <label for="inputEmail4">Sal</label>
                <input type="text" class="form-control" style="max-width:100%" name="sel" ng-model="StudentInfo.Salutation" />
            </div>
            <div class="form-group col-md-3">
                <label for="inputEmail4">First Name<span class="red">*</span></label>
                <input type="text" class="form-control" style="max-width:100%" name="fname" ng-model="StudentInfo.FirstName" required ng-class="{true: 'error'}[submitted() && userform.fname.$invalid]" />
            </div>
            <div class="form-group col-md-3">
                <label for="inputEmail4">Middle name</label>
                <input type="text" class="form-control" style="max-width:100%" name="middlename" ng-model="StudentInfo.MidName" />
            </div>
            <div class="form-group col-md-3">
                <label for="inputEmail4">Last Name</label>
                <input type="text" class="form-control" style="max-width:100%" name="lastname" ng-model="StudentInfo.LastName" />
            </div>
        </div>

        <div class="form-row">
            <div class="container my-12">
                <!--Accordion wrapper-->
                <div class="accordion md-accordion" id="accordionEx" role="tablist" aria-multiselectable="true">
                    <!-- Accordion card -->
                    <div class="card">
                        <!-- Card header -->
                        <div class="card-header" role="tab" id="basicInfo">
                            <a data-toggle="collapse" data-parent="#accordionEx" href="#Basic" aria-expanded="true"
                               aria-controls="Basic">
                                <h5 class="mb-0">
                                    BASIC <i class="fa fa-angle-down rotate-icon"></i>
                                </h5>
                            </a>
                        </div>

                        <!-- Card body -->
                        <div id="Basic" class="collapse show" role="tabpanel" aria-labelledby="basicInfo"
                             data-parent="#accordionEx">
                            <div class="card-body">
                                <div ng-if="frmMode==2">
                                    <div class="form-row">
                                        <div class="form-group col-md-4">
                                            <label for="inputEmail4">Serial No.</label>
                                            <input type="text" class="form-control numeric" style="max-width:100%" name="sel" ng-model="studentBasicInfo.SerialNo" />
                                        </div>
                                        <div class="form-group col-md-4">
                                            <label for="inputEmail4">Roll No.</label>
                                            <input type="text" class="form-control numeric" style="max-width:100%" name="firstname" ng-model="studentBasicInfo.RollNum" />
                                        </div>
                                        <div class="form-group col-md-4">
                                            <label for="inputEmail4">Admission Date</label>
                                            <div class="input-group">
                                                <input name="admnDate" id="admissionDate" type="text" ng-model="studentBasicInfo.AdmissionDate" class="form-control admnDate" aria-describedby="basic-addon1" style="min-width:100%" />
                                                <label class="input-group-addon btn" for="date" style="position: absolute; margin-left: 290px; z-index:9">
                                                    <span class="fa fa-calendar open-datetimepicker" id="basic-addon1" style="cursor:pointer"></span>
                                                </label>
                                                <label class="input-group-addon btn" for="close" style="position: absolute;margin-left: 270px;z-index:9;" ng-click="dateClean('admissionDate')">
                                                    <span class="fa fa-close" id="basic-addon1" style="cursor:pointer"></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col-md-4">
                                            <label for="inputEmail4">Class<span class="red">*</span></label>
                                            <select name="class" ng-model="studentBasicInfo.ClassIDSelected" ng-options="itemcoun.ClassName for itemcoun in dsCombo.Class track by itemcoun.ClassID" style="min-width:100%" Class="form-control" required ng-class="{true: 'error'}[submitted() && userform.class.$invalid]"></select>
                                        </div>
                                        <div class="form-group col-md-4">
                                            <label for="inputEmail4">Campus<span class="red">*</span></label>
                                            <select name="campus" ng-model="studentBasicInfo.CampusIDSelected" ng-options="itemcoun.DispName for itemcoun in dsCombo.campus track by itemcoun.DispName" style="min-width:100%" Class="form-control" required ng-class="{true: 'error'}[submitted() && userform.campus.$invalid]"></select>
                                        </div>
                                        <div class="form-group col-md-4">
                                            <label for="inputEmail4">Shift<span class="red">*</span></label>
                                            <select name="shift" ng-model="studentBasicInfo.ShiftIDSelected" ng-options="itemcoun.Shift for itemcoun in dsCombo.shift track by itemcoun.Shift" style="min-width:100%" Class="form-control" required ng-class="{true: 'error'}[submitted() && userform.shift.$invalid]"></select>
                                        </div>
                                    </div>
                                </div>
                                <div ng-if="frmMode==1">
                                    <table class="table table-sm" style="width:100%">
                                        <thead>
                                            <tr>
                                                <th>#</th>
                                                <th>Roll Number</th>
                                                <th>Class ID</th>
                                                <th>Admission Date</th>
                                                <th>Leave Date</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr ng-repeat="stu in ListStu track by $index" ng-show="ListStu.length > 0">
                                                <td>{{$index + 1}}.</td>
                                                <td>{{stu.RollNum}}</td>
                                                <td>{{stu.ClassID}}</td>
                                                <td>{{stu.AdmissionDate| date : "dd, MMM yyyy"}}</td>
                                                <td>{{stu.LeaveDate| date : "dd, MMM yyyy"}}</td>
                                                <td>
                                                    <a href="javascript:void(0)" ng-click="efnc(stu, 'edit')"><i class="fa fa-edit"></i></a>&nbsp;&nbsp;
                                                    <a href="javascript:void(0)" ng-click="efnc(stu, 'add')"><i class="fa fa-plus"></i></a>
                                                </td>
                                            </tr>
                                            <tr ng-show="!ListStu.length">
                                                <td colspan="6" style="text-align:center;font-size: 20px;">No Records Found...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Accordion card -->
                    <!-- Accordion card -->
                    <div class="card">
                        <!-- Card header -->
                        <div class="card-header" role="tab" id="AddressInfo">
                            <a class="collapsed" data-toggle="collapse" data-parent="#accordionEx" href="#Address"
                               aria-expanded="false" aria-controls="Address">
                                <h5 class="mb-0">
                                    ADDRESS <i class="fa fa-angle-down rotate-icon"></i>
                                </h5>
                            </a>
                        </div>

                        <!-- Card body -->
                        <div id="Address" class="collapse" role="tabpanel" aria-labelledby="AddressInfo"
                             data-parent="#accordionEx">
                            <div class="card-body">
                                <div class="form-row">
                                    <div class="form-group col-md-6">
                                        <label for="inputEmail4">Email<span class="red">*</span></label>
                                        <input type="text" class="form-control" style="max-width:100%" name="email" ng-model="StudentInfo.Email" required ng-class="{true: 'error'}[submitted() && userform.email.$invalid]" />
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="inputEmail4">Mobile<span class="red">*</span></label>
                                        <input type="text" class="form-control numeric" style="max-width:100%" name="mobilenumber" ng-model="StudentInfo.CellNum" required ng-class="{true: 'error'}[submitted() && userform.mobilenumber.$invalid]" />
                                    </div>
                                </div>
                                <p style="font-weight: 400;font-size: 18px;"><u>Present Address</u></p>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div Class="row">
                                            <div class="col-md-6">
                                                <label class="control-label labeltext">Address</label>
                                                <textarea name="cadd" style="height:120px;resize:none;max-width:540px;" ng-model="StudentInfo.PrAddress" class="form-control"></textarea>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <label class="control-label labeltext">City</label>
                                                        <input name="city" type="text" ng-model="StudentInfo.PrCity" Class="form-control" />
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="control-label labeltext">Phone No.</label>
                                                        <label>
                                                            <input type="text" ng-model="StudentInfo.PrPhCountry" class="input-group-addon numeric" style="width:20%;" />
                                                            <input type="text" ng-model="StudentInfo.PrPhArea" class="input-group-addon numeric" style="width:20%" />
                                                            <input type="text" ng-model="StudentInfo.PrPhone" class="input-group-addon numeric" style="width:56%" />
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div Class="col-md-6">
                                                        <Label Class="control-label labeltext">Country</Label>
                                                        <select name="country" ng-model="StudentInfo.PrCountrySelected" ng-options="itemcoun.countryname for itemcoun in dsCombo.CO track by itemcoun.countrycode" ng-change="changestate(StudentInfo.PrCountrySelected)" Class="form-control"></select>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <Label Class="control-label labeltext">State</Label>
                                                        <select name="state" ng-model="StudentInfo.PrStateSelected" ng-options="itemsu.SubDivisionName for itemsu in StateByCountry track by itemsu.SubDivisionName" Class="form-control"></select>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <Label Class="control-label labeltext">PinCode </Label>
                                                <input name="pincode" type="text" numbers-only ng-model="StudentInfo.PrPinCode" maxlength="6" class="form-control numeric" />
                                            </div>
                                            <div class="col-md-4">
                                                <Label Class="control-label labeltext">Geo Point</Label>
                                                <input name="prgeopoint" type="text" ng-model="StudentInfo.PrGeoPoint" class="form-control" />
                                            </div>
                                            <div class="col-md-2">
                                                @*<a href="javsscript:void(0)" class="btn btn-default" style="margin-top:34px;margin-left: -50px;">Lookup</a>*@
                                            </div>
                                            <div class="col-md-2">
                                                <a href="javsscript:void(0)" class="btn btn-default" style="margin-top:34px;" ng-click="copyAddress()">Copy Address</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <br />
                                <p style="font-weight: 400;font-size: 18px;"><u>Permanent Address</u></p>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div Class="row">
                                            <div class="col-md-6">
                                                <label class="control-label labeltext">Address</label>
                                                <textarea name="cadd" style="height:120px;resize:none;max-width:540px;" ng-model="StudentInfo.PmAddress" class="form-control"></textarea>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <label class="control-label labeltext">City</label>
                                                        <input name="city" type="text" ng-model="StudentInfo.PmCity" Class="form-control" />
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="control-label labeltext">Phone No.</label>
                                                        <label>
                                                            <input type="text" ng-model="StudentInfo.PmPhCountry" class="input-group-addon numeric" style="width:20%;" />
                                                            <input type="text" ng-model="StudentInfo.PmPhArea" class="input-group-addon numeric" style="width:20%" />
                                                            <input type="text" ng-model="StudentInfo.PmPhone" class="input-group-addon numeric" style="width:56%" />
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div Class="col-md-6">
                                                        <Label Class="control-label labeltext">Country</Label>
                                                        <select name="country" ng-model="StudentInfo.PmCountrySelected" ng-options="itemcoun.countryname for itemcoun in dsCombo.CO track by itemcoun.countrycode" ng-change="changestate(StudentInfo.PmCountrySelected)" Class="form-control"></select>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <Label Class="control-label labeltext">State</Label>
                                                        <select name="state" ng-model="StudentInfo.PmStateSelected" ng-options="itemsu.SubDivisionName for itemsu in StateByCountry track by itemsu.SubDivisionName" Class="form-control"></select>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <Label Class="control-label labeltext">PinCode </Label>
                                                <input name="pincode" type="text" numbers-only ng-model="StudentInfo.PmPinCode" maxlength="6" class="form-control" />
                                            </div>
                                            <div class="col-md-4">
                                                <Label Class="control-label labeltext">Geo Point</Label>
                                                <input name="pmgeopoint" type="text" ng-model="StudentInfo.PmGeoPoint" class="form-control" />
                                            </div>
                                            <div class="col-md-2">
                                                @*<a href="javsscript:void(0)" class="btn btn-default" style="margin-top:34px;margin-left: -50px;">Lookup</a>*@
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Accordion card -->
                    <!-- Accordion card -->
                    <div class="card">
                        <!-- Card header -->
                        <div class="card-header" role="tab" id="Info">
                            <a class="collapsed" data-toggle="collapse" data-parent="#accordionEx" href="#SInfo"
                               aria-expanded="false" aria-controls="SInfo">
                                <h5 class="mb-0">
                                    INFO <i class="fa fa-angle-down rotate-icon"></i>
                                </h5>
                            </a>
                        </div>

                        <!-- Card body -->
                        <div id="SInfo" class="collapse" role="tabpanel" aria-labelledby="Info"
                             data-parent="#accordionEx">
                            <div class="card-body" style="padding: 0rem 0.5rem 0rem 0.5rem">
                                <div class="form-row">
                                    <div class="form-group col-md-2">
                                        <label for="inputEmail4">Enrollment No.</label>
                                        <input type="text" class="form-control" style="max-width:100%" name="EnrollmentNo" ng-model="StudentInfo.EnrollmentNum" />
                                    </div>
                                    <div class="form-group col-md-2">
                                        <label for="inputEmail4">NAD Number</label>
                                        <input type="text" class="form-control" style="max-width:100%" name="NADNumber" ng-model="StudentInfo.NADNumber" />
                                    </div>                                    
                                    <div class="form-group col-md-3">
                                        <label for="inputEmail4">Father Name</label>
                                        <input type="text" class="form-control" style="max-width:100%" name="FatherName" ng-model="StudentInfo.FatherName" />
                                    </div>
                                    <div class="form-group col-md-2">
                                        <label for="inputEmail4">Gender<span class="red">*</span></label>
                                        <select name="gender" ng-model="StudentInfo.IsFemaleSelected" ng-options="itemcoun.DisplayText for itemcoun in ValueLists.IsFemale.ValueListItems track by itemcoun.DisplayText" Class="form-control" required ng-class="{true: 'error'}[submitted() && userform.gender.$invalid]"></select>
                                    </div>
                                    <div class="form-group col-md-3">
                                        <label for="inputEmail4">Mother Name</label>
                                        <input type="text" class="form-control" style="max-width:100%" name="sel" ng-model="StudentInfo.MotherName" />
                                    </div>
                                </div>
                            </div>
                            <div class="card-body" style="padding: 0rem 0.5rem 0rem 0.5rem">
                                <div class="form-row">
                                    <div class="form-group col-md-3">
                                        <label for="inputEmail4">Display Name</label>
                                        <input type="text" class="form-control" style="max-width:100%" name="firstname" ng-model="StudentInfo.NickName" />
                                    </div>
                                    <div class="form-group col-md-3">
                                        <label for="inputEmail4">Aadhar<span class="red">*</span></label>
                                        <input type="text" class="form-control numric" style="max-width:100%" name="aadharNumber" ng-model="StudentInfo.Aadhar" required ng-class="{true: 'error'}[submitted() && userform.aadharNumber.$invalid]" />
                                    </div>
                                    <div class="form-group col-md-3">
                                        <label for="inputEmail4">Aadhar Enrolment No.</label>
                                        <input type="text" class="form-control" style="max-width:100%" name="firstname" ng-model="StudentInfo.AadharEnrollment" />
                                    </div>
                                    <div class="form-group col-md-3">
                                        <label for="inputEmail4">Age Years</label>
                                        <input type="text" class="form-control numeric" style="max-width:100%" name="sel" ng-model="StudentInfo.AgeYears" />
                                    </div>

                                </div>
                            </div>
                            <div class="card-body" style="padding: 0rem 0.5rem 0rem 0.5rem">
                                <div class="form-row">
                                    <div class="form-group col-md-3">
                                        <label for="inputEmail4">EWS</label>
                                        <input type="text" class="form-control" style="max-width:100%" name="firstname" ng-model="StudentInfo.EWS" />
                                    </div>
                                    <div class="form-group col-md-3">
                                        <label for="inputEmail4">DOB<span class="red">*</span></label>
                                        <input type="text" id="dateofBirth" name="birthday" class="form-control admnDate" ng-model="StudentInfo.Birthday" aria-describedby="basic-addon" required ng-class="{true: 'error'}[submitted() && userform.birthday.$invalid]" />
                                        <label class="input-group-addon btn" for="date" style="position: absolute; margin-left: 210px;margin-top: -37px; z-index:9">
                                            <span class="fa fa-calendar open-datetimepicker" id="basic-addon" style="cursor:pointer"></span>
                                        </label>
                                        <label class="input-group-addon btn" for="close" style="position: absolute;margin-left: 190px;z-index:9;margin-top: -37px;" ng-click="dateClean('dateofBirth')">
                                            <span class="fa fa-close" id="basic-addon1" style="cursor:pointer"></span>
                                        </label>
                                    </div>
                                    <div class="form-group col-md-3">
                                        <label for="inputEmail4">Category</label>
                                        <select name="category" ng-model="StudentInfo.CategorySelected" ng-options="cat.Descrip for cat in dsCombo.Category track by cat.Code" Class="form-control"></select>
                                    </div>
                                    @*<div class="form-group col-md-3">
                                            <label for="inputEmail4">X<sup>th</sup> Marks Sheet Number </label>
                                            <input type="text" class="form-control numeric" style="max-width:100%" name="markssheetserial" ng-model="StudentInfo.XthMarksSheetSerial" />
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label for="inputEmail4">X<sup>th</sup> Year</label>
                                            <input type="text" class="form-control numeric" maxlength="4" style="max-width:100%" name="passyear" ng-model="StudentInfo.XthPassYear" />
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label for="inputEmail4">XII<sup>th</sup> Roll Number</label>
                                            <input type="text" class="form-control numeric" style="max-width:100%" name="rollnumber" ng-model="StudentInfo.XIIthRollNum" />
                                        </div>*@
                                    <div class="form-group col-md-3">
                                        <label for="inputEmail4">Reservation<span class="red">*</span></label>
                                        <select name="reservationid" ng-model="StudentInfo.ReservationSelected" ng-options="res.Descrip for res in dsCombo.Reservation track by res.Code" style="min-width:100%" Class="form-control" required ng-class="{true: 'error'}[submitted() && userform.reservationid.$invalid]"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body" style="padding: 0rem 0.5rem 0rem 0.5rem">
                                <div class="form-row">
                                    <div class="form-group col-md-4">
                                        <label for="inputEmail4">User</label>
                                        <select name="userid" ng-model="StudentInfo.UserIDSelected" ng-options="usr.username for usr in dsCombo.user track by usr.userid" style="min-width:100%" Class="form-control"></select>
                                    </div>
                                    <div class="form-group col-md-4">
                                        <label for="inputEmail4">Profile</label>
                                        <input type="text" class="form-control" style="max-width:100%" name="sel" ng-model="StudentInfo.Profile" />
                                    </div>
                                    <div class="form-group col-md-4">
                                        <label for="inputEmail4">Remarks</label>
                                        <input type="text" class="form-control" style="max-width:100%" name="firstname" ng-model="StudentInfo.Remark" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Accordion card -->
                    <!-- Accordion card -->
                    <div class="card">
                        <!-- Card header -->
                        <div class="card-header" role="tab" id="FamilyInfo">
                            <a class="collapsed" data-toggle="collapse" data-parent="#accordionEx" href="#family"
                               aria-expanded="false" aria-controls="family">
                                <h5 class="mb-0">
                                    FAMILY <i class="fa fa-angle-down rotate-icon"></i>
                                </h5>
                            </a>
                        </div>

                        <!-- Card body -->
                        <div id="family" class="collapse" role="tabpanel" aria-labelledby="FamilyInfo"
                             data-parent="#accordionEx">
                            <div class="card-body">
                                <div class="form-row">
                                    <div class="form-group col-md-11">
                                        <table id="tblFamilyMember" class="table table-sm" style="width:100%">
                                            <thead>
                                                <tr>
                                                    <th>#</th>
                                                    <th>Member Name</th>
                                                    <th>Relation</th>
                                                    <th>Birth Day On</th>
                                                    <th>Profession</th>
                                                    <th>Member Address</th>
                                                    <th>Other</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr ng-repeat="fem in Family" ng-show="Family.length > 0">
                                                    <td>{{$index + 1}}</td>
                                                    <td><input type="text" class="form-control" ng-model="fem.MemberName" /></td>
                                                    <td><input type="text" class="form-control" ng-model="fem.Relation" /></td>
                                                    <td>
                                                        <input type="text" id="BDate_{{$index}}" class="form-control admnDate" ng-model="fem.BDate" value="{{fem.BDate | date:'dd/MM/yyyy'}}" aria-describedby="basic-addon{{$index}}" />
                                                        <label class="input-group-addon btn" for="date" style="position: absolute; margin-left: 100px;margin-top: -37px; z-index:9">
                                                            <span class="fa fa-calendar open-datetimepicker" id="basic-addon{{$index}}" style="cursor:pointer"></span>
                                                        </label>
                                                        <label class="input-group-addon btn" for="close" style="position: absolute;margin-left: 85px;z-index:9;margin-top: -37px;" ng-click="dateClear('BDate_',$index)">
                                                            <span class="fa fa-close" id="basic-addon1" style="cursor:pointer"></span>
                                                        </label>
                                                    </td>
                                                    <td><input type="text" class="form-control" ng-model="fem.Profession" /></td>
                                                    <td><input type="text" class="form-control" ng-model="fem.MemberAddress" /></td>
                                                    <td><input type="text" class="form-control" ng-model="fem.Other" /></td>
                                                    <td><a href="javascript:void(0)" ng-click="deletefamilyRow($index)"><i class="fa fa-trash"></i></a></td>
                                                </tr>
                                                <tr ng-show="!Family.length">
                                                    <td colspan="8" style="text-align:center;font-size: 20px;">No Records Found...</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="form-group col-md-1">
                                        <div style="float:right; margin-bottom:5px;">
                                            <button type="button" id="btnAddNew" Class="btn btn-default btnf" ng-click="addFamilyInfo(Family.length)"><i class="fa fa-plus"></i></button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Accordion card -->
                    <!-- Accordion card -->
                    <div class="card">
                        <!-- Card header -->
                        <div class="card-header" role="tab" id="EducationInfo">
                            <a class="collapsed" data-toggle="collapse" data-parent="#accordionEx" href="#education"
                               aria-expanded="false" aria-controls="education">
                                <h5 class="mb-0">
                                    Education <i class="fa fa-angle-down rotate-icon"></i>
                                </h5>
                            </a>
                        </div>

                        <!-- Card body -->
                        <div id="education" class="collapse" role="tabpanel" aria-labelledby="EducationInfo"
                             data-parent="#accordionEx">
                            <div class="card-body">
                                <div class="form-row">
                                    <div class="form-group col-md-11">
                                        <table id="tblEducationMember" class="table table-sm" style="width:100%">
                                            <thead>
                                                <tr>
                                                    <th>#</th>
                                                    <th>Qualification</th>
                                                    <th>Institution</th>
                                                    <th>Board</th>
                                                    <th>Passing Year</th>
                                                    <th>MarkSheet No.</th>
                                                    <th>Roll No.</th>
                                                    <th>Marks Obtained</th>
                                                    <th>Percentage</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr ng-repeat="edu in education" ng-show="education.length > 0">
                                                    <td>{{$index + 1}}.</td>
                                                    <td><input type="text" class="form-control" ng-model="edu.Qualification" /></td>
                                                    <td><input type="text" class="form-control" ng-model="edu.Institution" /></td>
                                                    <td><input type="text" class="form-control" ng-model="edu.Board" /></td>
                                                    <td><input type="text" class="form-control numeric" ng-model="edu.YearQual" /></td>
                                                    <td><input type="text" class="form-control" ng-model="edu.MarksheetNo" /></td>
                                                    <td><input type="text" class="form-control numeric" ng-model="edu.RollNo" /></td>
                                                    <td><input type="text" class="form-control" ng-model="edu.Marks" /></td>
                                                    <td><input type="text" class="form-control" ng-model="edu.PerMarks" /></td>
                                                    <td><a href="javascript:void(0)" ng-click="deleteEducationRow($index)"><i class="fa fa-trash"></i></a></td>
                                                </tr>
                                                <tr ng-show="!education.length">
                                                    <td colspan="7" style="text-align:center;font-size: 20px;">No Records Found...</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="form-group col-md-1">
                                        <div style="float:right; margin-bottom:5px;">
                                            <button type="button" id="btnAddNew" Class="btn btn-default btnf" ng-click="addEducationInfo(education.length)"><i class="fa fa-plus"></i></button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Accordion card -->
                    <!-- Accordion card -->
                    <div class="card">
                        <!-- Card header -->
                        <div class="card-header" role="tab" id="PictureInfo">
                            <a class="collapsed" data-toggle="collapse" data-parent="#accordionEx" href="#picture"
                               aria-expanded="false" aria-controls="picture">
                                <h5 class="mb-0">
                                    PICTURE <i class="fa fa-angle-down rotate-icon"></i>
                                </h5>
                            </a>
                        </div>
                        <!-- Card body -->
                        <div id="picture" class="collapse" role="tabpanel" aria-labelledby="PictureInfo"
                             data-parent="#accordionEx">
                            <div class="card-body">
                                <div class="form-row" style="margin-top: 5px;">
                                    <div class="form-group col-md-2">
                                        <img ng-src="{{imageUrl}}" id="imgInp" alt="sample Image" style="width: 130px;">
                                    </div>
                                    <div class="form-group col-md-9">
                                        <label for="staticEmail" class="col-form-label" style="margin-left: 25px;">File</label>
                                        <input type="file" id="attach_filename" name="attach_filename" class="form-control" accept=".jpg, .jpeg, .png" autocomplete="off" style="max-width: 88%;margin-top: -35px;margin-left: 80px;" />
                                    </div>
                                    <div class="col-md-1">
                                        <button type="button" id="btnAlumniPic" class="btn btn-default btnf" ng-click="UploadStudentPic()" style="margin-top:3px;">Upload</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Accordion card -->
                </div>
                <!-- Accordion wrapper -->
            </div>
        </div>
        <!-- End Page Content-->
        <hr />
        @Html.Partial("_SavePanel")

        <!-- Modal -->
        <div class="modal fade" id="errorModel" role="dialog">
            <div class="modal-dialog">
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Error</h4>
                    </div>
                    <div class="modal-body">
                        <p style="font-size: 16px;"> Please upload valid file extension like (jpg, jpeg, png). </p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

@section botscripts{
    <script type="text/javascript">
        $(function () {
            $(".admnDate").datetimepicker({
                format: 'Y/m/d',
                timepicker: false,
            }).attr('readonly', 'readonly');
        });

        rsApp.controller('FormController', function ($scope, $http, usSpinnerService) {
            $scope.model = JSON.parse($("#model_json").val());
            $scope.status = 'loaded';

            var loadmodel = function (result) {
                $scope.model = result;
                //FORM MODE
                $scope.frmMode = $scope.model.frmMode;
                //set Student Model in scope
                $scope.StudentInfo = $scope.model.dsForm.DT[0];
                //Student Basic Information
                $scope.ListStu = $scope.model.GridViews.ListStu.MainGrid.myDS.Table;
                $scope.studentBasicInfo = {};
                //Set Page Heading
                $scope.title = ($scope.model.frmMode == 2 ? "Add" : $scope.model.frmMode == 1 ? "Edit" : "");
                //Show Hide Delete Buttons
                $scope.visdel = ($scope.model.frmMode == 2 ? false : true);
                //Bind Family Info
                $scope.Family = $scope.model.GridViews.Fam.MainGrid.myDS.dt;
                //Date Format
                for (var i = 0; i < $scope.Family.length; i++) {
                    $scope.Family[i].BDate = $scope.Family[i].BDate == undefined ? "" : new moment($scope.Family[i].BDate).format("YYYY-MM-D");
                }

                //Education INFO
                if (Array.isArray($scope.model.GridViews.Education.MainGrid.myDS.dt) && $scope.model.GridViews.Education.MainGrid.myDS.dt.length > 0) {
                    $scope.education = $scope.model.GridViews.Education.MainGrid.myDS.dt;
                } else {
                    $scope.education = [];
                }
                //Bind Country
                $scope.dsCombo = $scope.model.dsCombo;
                $scope.ValueLists = $scope.model.ValueLists;
                //Date Format
                $scope.StudentInfo.Birthday = $scope.StudentInfo.Birthday == undefined ? "" : new moment($scope.StudentInfo.Birthday).format("YYYY-MM-D");
                //Bind Dropdown Selected Value
                @Html.RenderLookup("StudentInfo", Model, Model.dsForm.Tables[0]);

                //Bind Initial Image
                if ($scope.StudentInfo.ImageUrl != undefined) {
                    $scope.url = '/frmStuPerson/ParamsOutput' + location.search;
                    $scope.payload = { serverPath: JSON.parse($scope.StudentInfo.ImageUrl)[0].blobname, PersonID: $scope.StudentInfo.PersonID };
                    payload = JSON.stringify($scope.payload);
                    var payloaddata = { key: 'download', Params: payload, __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val() };

                    $.post($scope.url, payloaddata, function (result) {
                        toDataURL(result.Data, function (dataUrl) {
                            $('#imgInp').attr('src', dataUrl);
                        });
                    });
                }
                else {
                    $scope.imageUrl = "/Content/Images/images.jpg";
                }

                $scope.UploadFiles = [];

                $scope.changestate = function (cCode) {
                    $scope.StateByCountry = [];
                    if (cCode) {
                        $.each($scope.dsCombo.SU, function (item, index) {
                            if (index.countrycode === cCode.countrycode) {
                                $scope.StateByCountry.push(index);
                            }
                        });
                    }
                };

                $scope.changestate($scope.StudentInfo.PrCountrySelected);
                $scope.changestate($scope.StudentInfo.PmCountrySelected);
                //Bind Education Info
                $scope.Education = [];
            }

            loadmodel($scope.model);

            $scope.copyAddress = function () {
                $scope.StudentInfo.PmAddress = $scope.StudentInfo.PrAddress;
                $scope.StudentInfo.PmCity = $scope.StudentInfo.PrCity;
                $scope.StudentInfo.PmPhCountry = $scope.StudentInfo.PrPhCountry ;
                $scope.StudentInfo.PmPhArea = $scope.StudentInfo.PrPhArea;
                $scope.StudentInfo.PmPhone = $scope.StudentInfo.PrPhone;
                $scope.StudentInfo.PmPinCode = $scope.StudentInfo.PrPinCode;
                $scope.StudentInfo.PmGeoPoint = $scope.StudentInfo.PrGeoPoint;
                $scope.StudentInfo.PmCountrySelected = $scope.StudentInfo.PrCountrySelected;
                $scope.StudentInfo.PmStateSelected = $scope.StudentInfo.PrStateSelected;
            }

            $scope.addFamilyInfo = function () {
                var entry = {};
                $(function () {
                    $(".admnDate").datetimepicker({
                        format: 'Y/m/d',
                        timepicker: false,
                    }).attr('readonly', 'readonly');
                });

                $scope.Family.push(entry);
            }

            $scope.deletefamilyRow = function (index) {
                $scope.Family.splice(index, 1);
            }

            $scope.add = function (index) {
                var entry = {};
                $scope.appkeys.push(entry);
                $scope.editMode[index] = true;
            };

            $scope.UploadStudentPic = function () {
                var fileExtn = '';
                var ctrlName = '';
                var hdnControl = '';
                var statusType = '';

                fileExtn = $('#attach_filename').val().split('.').pop().toLowerCase();
                // For Progress baar
                ctrlName = $('#attach_filename');
                filec = $('#attach_filename').val();
                hdnControl = 'attach_filename';
                statusType = 'studentPic';

                if (fileExtn !== "jpeg" && fileExtn !== "jpg" && fileExtn !== "png") {
                    $('#errorModel').modal('toggle');
                    $scope.isbtnAttachmentUpload = "";
                    return false;
                }

                var url = '/frmStuPerson/ParamsOutput' + location.search;
                var payload = { filename: filec };
                payload = JSON.stringify(payload);
                var payloaddata = { key: 'sas', Params: payload, __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val() };

                $scope.UploadFile(url, payloaddata, true, ctrlName, hdnControl, statusType);
            }

            $scope.calculatemodel = function () {
                if ($scope.frmMode == 2) {
                    $scope.model.GridViews.ListStu.MainGrid.myDS.Table.push($scope.studentBasicInfo);
                }
                if (Array.isArray($scope.UploadFiles) && $scope.UploadFiles.length) {
                    $scope.model.dsForm.DT[0].ImageUrl = JSON.stringify($scope.UploadFiles);
                }
                if (Array.isArray($scope.education) && $scope.education.length) {
                    $scope.model.GridViews.Education.MainGrid.myDS.dt = $scope.education;
                }
            }

            $scope.cleanupmodel = function (datamodel) {
                if ($('#admissionDate').val() == "") {
                    datamodel.dsForm.DT[0].BDate = null;
                }
                //if ($('#dateofBirth').val() == "") {
                //    datamodel.dsForm.DT[0].Birthday = null;
                //}
            }

            $scope.efnc = function (row, type) {
                var base = '/App/Link' + location.search;
                var payload;
                if (type == "add") {
                    payload = { fKey: 'frmStudent', fMode: 'acAddM', IDX: 0, rowData: JSON.stringify(row) };
                } else {
                    payload = { fKey: 'frmStudent', fMode: 'acEditM', IDX: row.StudentID, rowData: JSON.stringify(row) };
                }
                $.post(base, payload, function (result) {
                    $scope.status = 'loaded';

                    window.location = result;
                    if (result.success) {
                        var data = JSON.parse(result.data);
                        loadmodel(data);
                        $scope.result = 'success';
                        $scope.message = '';
                    }
                    else {
                        if (result.message === '') { result.message = 'Unknown Error!' };


                        $scope.result = 'failure';
                        $scope.message = result.message;
                    }
                    $scope.$apply();
                    return;
                });
            }

            //Delete Records
            $scope.GenerateDelPayload = function () {
                //Pass the EntityKey in lowercase
                var payload = { EntityKey: 'persons', ID: $scope.model.dsForm.DT[0].PersonID, AcceptWarning: false };
                return payload;
            };

            $scope.dateClear = function (ctrlID, index) {
                $('#' + ctrlID + index).val('');
            };

            $scope.addEducationInfo = function () {
                var entry = {};
                $scope.education.push(entry);
            }

            $scope.deleteEducationRow = function (index) {
                $scope.education.splice(index, 1);
            }

            @Html.RenderFile("~/scripts/uploadCollegeFiles.js");
            @Html.RenderFile("~/scripts/rsforms.js");
        });
    </script>
}



